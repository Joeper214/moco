var lock_scroller=false;var all_applicatures_loaded=false;var TYPE_ERROR="error";var TYPE_SUCCESS="success";var already_voted=false;var already_favourite=false;var already_comment_loaded=false;var rate_btn=false;var ver_w=114;var old_comments_link="first";var chk_view_coms_ready=0;var votes_arr=new Array();votes_arr[0]="please rate";votes_arr[1]="poor";votes_arr[2]="not so good";votes_arr[3]="worth learning";votes_arr[4]="accurate";votes_arr[5]="excellent!";var current_fontsize_counter=0;var default_fontsize=12;var current_fontsize=12;var scroll_value_duration=100;var is_transpose_locked=false;var first_link="";var ui_dragable=1000;var SF_PATH="//img"+ug_serv+"/js/soundfont";var isAudioSupported=false;var q=0;var accords=new Array();accords[1]="C";accords[2]="C#";accords[3]="D";accords[4]="D#";accords[5]="E";accords[6]="F";accords[7]="F#";accords[8]="G";accords[9]="G#";accords[10]="A";accords[11]="A#";accords[12]="B";var cnt=accords.length-1;var applicature_animation=false;var loc=document.location.toString();var def=loc.indexOf("view_on");var uniq_cnt=0;var vote_txt=$(".cnt_rate").html();var current_transpose=0;var saved_transposed_states={};var show_bad_comments=false;if(typeof applicature==="undefined"){var applicature={}}function message_popup(d,b){$("#popup_info_msg").remove();var c=((b==TYPE_ERROR)?"error":"success");var a=2000;if(c==TYPE_SUCCESS){a=700}$('<div id="popup_info_msg" class="'+c+'"><b></b><div>'+d+"</div></div>").appendTo("body").fadeIn(300).delay(a).fadeOut(500)}function stars_fill(b,a){$("div.voting").each(function(c){$(this).children("a").removeClass("cur hovered");$(this).children("a:lt("+b+")").addClass(a?"hovered":"cur")});$("div.vote-success").html(votes_arr[b])}function increase_votes(a){current_rating_count+=a;$("div.v_c").text(" x "+current_rating_count)}function initFontsize(){var a=parseInt($.cookie("tabs_font_size"));if((a!=0)&&(a<=5)&&(a>=-2)){onFontsizeClick(a)}}function widgetScrollValue(h,d,c,j){var e=j>0?"+":"";var f=d>0?"down":"up";var i=d<0?"down":"up";var g=$("#"+h+"_content_val");var b=$("#"+h+"_val");var a=$("#"+h);if(j==0){b.hide("drop",{direction:f},scroll_value_duration,function(){g.text(0);a.show("drop",{direction:i},scroll_value_duration)});return}if(c!=0){g.hide("drop",{direction:f},scroll_value_duration,function(){g.text(e+j);g.show("drop",{direction:i},scroll_value_duration)})}else{a.hide("drop",{direction:f},scroll_value_duration,function(){g.text(e+j);b.show("drop",{direction:i},scroll_value_duration)})}}function onTransposeClick(b){if(is_transpose_locked){return}if(b==0){return}is_transpose_locked=true;var a=current_transpose;current_transpose=(current_transpose+b)%12;b=(current_transpose==0)?-a:b;save_transpose_state_to_local_storage();transpose(acc_tuning,b,function(){$("#cont span").each(function(){var e=$(this);var c=e.text();for(var d in applicature){if(applicature[d]["old_ch"]==c){e.text(d);break}}});create_chords_list();$("div.chord-variations-wrapper.ui-draggable").each(function(){var e=$(this);var c=e.find("div.diag_head").text();for(var d in applicature){if(applicature[d]["old_ch"]==c){e.html(create_applicature_widget(d,acc_tuning).html());break}}})},{});widgetScrollValue("transpose",b,a,current_transpose)}function save_transpose_state_to_local_storage(){if((isLocalStorageAvailable()!=false)&&(isJsonAvailable()!=false)){if(current_transpose!=0){saved_transposed_states[tabid]=current_transpose}else{if(saved_transposed_states[tabid]!=null){delete saved_transposed_states[tabid]}}localStorage.setItem("tabs_transpose_states",JSON.stringify(saved_transposed_states))}}function get_transpose_state_from_local_storage(){if((isLocalStorageAvailable()!=false)&&(isJsonAvailable()!=false)){var b=localStorage.getItem("tabs_transpose_states");try{if((b!=null)&&(b.length>2)){saved_transposed_states=JSON.parse(b);if(saved_transposed_states[tabid]!=null){onTransposeClick(saved_transposed_states[tabid])}}else{saved_transposed_states={}}}catch(a){saved_transposed_states={};localStorage.setItem("tabs_transpose_states",JSON.stringify(saved_transposed_states))}}}function onFontsizeClick(c){if(c==0){return}var b=current_fontsize_counter+c;if(b<-2){return}if(b>5){return}var a=current_fontsize_counter;ga_track_event(["_trackEvent","Tab Page","Font Size","Font Size "+(c>0?"Plus":"Minus")]);current_fontsize_counter=b;current_fontsize=current_fontsize+2*c;$("#cont").children("pre").css("font-size",current_fontsize+"px");$(document).trigger("changefontsize");$.cookie("tabs_font_size",current_fontsize_counter,{expires:365,path:"/",domain:"tabs"+ug_serv});widgetScrollValue("fontsize",c,a,current_fontsize_counter)}function onVariationsClick(a){if(!all_applicatures_loaded){transpose(acc_tuning,0,function(b){onAllVariationsLoaded(function(){showVariations(b)})},a)}else{showVariations(a)}}function onAllVariationsLoaded(b,a){$("div.chord-variations-wrapper").each(function(){var d=$(this);var c=d.find("div.diag_head").text();c=Chord.convertChordName(c);if(c!==undefined){var e=build_variations_list(applicature[c],acc_tuning);d.find("div.chords_versions_handler").html(render_variations_list(e)+render_variations_controls(e))}});b(a)}function showVariations(b){var j=b.button;var f=j.closest("div.chord-variations-wrapper");if(ui_dragable!=f.css("z-index")){ui_dragable++;f.css("z-index",ui_dragable)}var c=f.parents("#chords_list").get(0)!=undefined;var h=c?"Display Chords":"Highlight chords";h+=" Variations";h+=j.parent().children(".chords_versions_handler").is(":visible")?" Hide":" Show";ga_track_event(["_trackEvent","Tab Page","Chords",h]);if(j.parent().children(".chords_versions_handler").is(":visible")){j.parent().children(".chords_versions_handler").fadeOut(1);j.parent().delay(100).css("width","0");if(f.hasClass("ui_not-draggable")){j.parent().parent().removeClass("hover")}}else{j.parent().children(".chords_versions_handler").fadeIn(100);j.parent().css("width","214px");var e=j.parent().find("div.chords_versions_scroller_moveable");var g=e.find("div.cont_chrd").length;var a=ver_w*g;var i=-(a-214);e.css("width",a+"px");var d=parseInt(e.css("margin-left"));if(d==0){j.parent().find("div.chords_versions_controls_left").fadeOut(100)}else{if(d==i){j.parent().find("div.chords_versions_controls_right").fadeOut(100)}}j.parent().parent().addClass("hover")}}function str_pad(c,g,f,d){var e="",a;var b=function(k,h){var l="",j;while(l.length<h){l+=k}l=l.substr(0,h);return l};if(d!="STR_PAD_LEFT"&&d!="STR_PAD_RIGHT"&&d!="STR_PAD_BOTH"){d="STR_PAD_RIGHT"}if((a=g-c.length)>0){if(d=="STR_PAD_LEFT"){c=b(f,a)+c}else{if(d=="STR_PAD_RIGHT"){c=c+b(f,a)}else{if(d=="STR_PAD_BOTH"){e=b(f,Math.ceil(a/2));c=e+c+e;c=c.substr(0,g)}}}}return c}function modulate_accord(g,f){f=parseInt(f,10);if(g.indexOf("/")!=-1){var b=g.split("/");if(b[1]!="9"){for(var e=0;e<b.length;e++){b[e]=modulate_accord(b[e],f)}return b.join("/")}}var c=g.charAt(0).toUpperCase()+g.substring(1);if(c.charAt(0)=="H"){c="B"+c.substring(1)}if(c.charAt(0)=="B"&&c.indexOf("#")!=-1){c=c.replace("#","");c="C"+c.substring(1)}if(c.charAt(0)=="E"&&c.indexOf("#")!=-1){c=c.replace("#","");c="F"+c.substring(1)}var a="";if(c.indexOf("#")!=-1){a=c.charAt(0)+"#"}else{if(c.substring(1).indexOf("b")!=-1){var d;for(var e=1;e<=cnt;e++){if(accords[e]==c.charAt(0)){d=e;break}}if(d==1){d=cnt}else{d--}a=accords[d]}else{a=c.charAt(0)}}for(var e=1;e<=cnt;e++){if(accords[e]==a){d=e;break}}d+=f;if(d<1){d+=cnt}if(d>cnt){d-=cnt}if(c.indexOf("#")!=-1){c=c.replace("#","")}else{if(c.substring(1).indexOf("b")!=-1){c=c.replace("b","")}}c=accords[d]+c.substring(1);return c}function ajax_change_ch_applicatures(d,c,b,a){d.tuning=c;$.ajax({type:"GET",url:"/applicature/?appl_api_version="+get_appl_api_version()+"&instr="+instr+"&callback=?",data:d,dataType:"json",timeout:20000,success:function(e){applicature=e;all_applicatures_loaded=true;is_transpose_locked=false;if(b&&a){b(a)}}})}function transpose(d,e,c,a){$("#print_link").attr("href",first_link+"?transpose="+current_transpose);var b={};$("#cont span").each(function(){var f=remove_frets_before_modulate($(this).text());if(e==0){b[f]=modulate_accord(f,-current_transpose)}else{b[f]=modulate_accord(f,e)}});ajax_change_ch_applicatures(b,d,c,a)}function trim(c,b){b=!b?" s\xA0":b.replace(/([\[\]\(\)\.\?\/\*\{\}\+\$\^\:])/g,"$1");var a=new RegExp("^["+b+"]+|["+b+"]+$","g");return c.replace(a,"")}function remove_frets_before_modulate(c){var b=/\([0-9XIV fr\.]+\)/;var a=c.replace(b,"");a=trim(a);return a}function chk_ch_highlight(){if($("#disp_ch_highlight").hasClass("on")){$("#cont").addClass("highlight");bind_hover()}else{$("#cont").removeClass("highlight");$("#cont span").unbind("mouseover")}}function create_chords_list(){var c=0;var a="";$("#chords_list").empty();for(var b in applicature){c++;a="";if(((c%6)==0)||(((c+1)%6)==0)){a+=" last6"}if(((c%4)==0)||(((c+1)%4)==0)){a+=" last4"}var d=create_applicature_widget(b,acc_tuning,{count_class:a});display_widget(d,null,false)}$("#chords_list div.chord-variations-wrapper").bind("mouseleave",function(){var e=$(this);if(!e.find(".chords_versions_handler").is(":visible")){e.removeAttr("style")}})}function display_widget(d,b,a){if(a){var c=b.offset();c.top-=180;c.left+=21;ui_dragable_firsttime=ui_dragable++;d.addClass("ui-draggable");d.addClass("was_not_draged");d.addClass("hover");d.appendTo("body");$.extend(d,{isBinded:true,chord:b});$.extend(b,{unbindWidget:function(){b.removeClass("has_undragable");b.unbind("mouseleave");d.isBinded=false;clearTimeout(b.leaveTimer)},removeWidget:function(){b.unbindWidget();d.remove()},startLeaveTimer:function(){d.addClass("removeable");b.leaveTimer=setTimeout(function(){clearTimeout(b.leaveTimer);b.removeWidget()},200)},stopLeaveTimer:function(){clearTimeout(b.leaveTimer);d.removeClass("removeable")},leaveTimer:null});d.css({position:"absolute",top:c.top,left:c.left,"z-index":ui_dragable_firsttime});d.draggable({handle:".diag_head",containment:"#scroll_holder",start:function(e,f){var g=f.helper;g.removeClass("was_not_draged");g.removeClass("removeable");b.unbindWidget();if(ui_dragable!=g.css("z-index")){ui_dragable++;g.css("z-index",ui_dragable)}}});b.bind("mouseleave",function(){b.startLeaveTimer();return false});d.bind("mouseover",function(){if(d.isBinded){b.stopLeaveTimer()}});d.bind("mouseleave",function(){if(!d.find(".chords_versions_handler").is(":visible")){if(d.isBinded){b.startLeaveTimer()}else{d.removeClass("hover")}}});d.find(".diag_head a").bind("click",function(){if(d.isBinded){b.removeWidget()}else{d.remove()}return false})}else{d.addClass("ui_not-draggable");d.find(".diag_head img").remove();d.appendTo("#chords_list")}d.find(".main_chord_with_play").find(".chfret_clicked_label").css("display","none");d.show()}function bind_hover(){$("#cont span").unbind("mouseover");$("#cont span").each(function(){var a=$(this);a.bind("mouseover",function(c){if(a.leaveTimer!==undefined){a.stopLeaveTimer()}if(a.hasClass("has_undragable")){return false}a.addClass("has_undragable");var b=a.text();var d=create_applicature_widget(b,acc_tuning,{vars_left:false});display_widget(d,a,true);return false})})}function hide_scroller_widget(){$(".autoscroll_controller").fadeOut(100);$(".b_a").removeClass("b_ac");tab_scroller.setHeight(0,true);tab_scroller.changeSpeed(0)}function hide_scroll(){if(document.getElementById("scroll").style.display=="none"){$("#scroll").show();$("#arr_scroll").css({background:"url(http://"+js_img_domain+"/img/arr.gif) 0px -40px"})}else{$("#scroll").hide();$("#arr_scroll").css({background:"url(http://"+js_img_domain+"/img/arr.gif)"})}}var TabScroller=function(){if($("#r_a").is(":visible")){$("#whole_scroll").css("top","250px")}this.of_top=$("#whole_scroll").offset().top;this.scrolling_speed=0;this.height_gradient=0;this.to="";this.move_area_coords;this.save_scroll_position=false;this.scroller_margin=15;this.memorized_position=parseInt($("#whole_scroll").css("top"));$("#speed div").click(function(a){tab_scroller.setHeight($(this).index()+1,true);tab_scroller.changeSpeed(($(this).index()+1)*100)});$("#speed div").mouseover(function(a){$("#speed div").removeClass("hover");$(this).addClass("hover");$(this).prevAll().addClass("hover")});$("#speed").mouseleave(function(a){tab_scroller.setHeight(tab_scroller.height_gradient)});$("#dec_speed").click(function(){tab_scroller.decSpeed()});$("#inc_speed").click(function(){tab_scroller.incSpeed()});$("#whole_scroll").draggable({stop:function(){if($("#whole_scroll").hasClass("fixed")){$("#whole_scroll").css({top:$("#whole_scroll").offset().top-$(".t_br").offset().top,left:$("#whole_scroll").offset().left-$(".t_br").offset().left});$("#whole_scroll").removeClass("fixed")}tab_scroller.save_scroll_position=false;tab_scroller.memorized_position=parseInt($("#whole_scroll").css("top"))}});$(document).keydown(function(a){if(typeof unknown_platform!="undefined"){return}if(lock_scroller){return}switch(a.keyCode){case 27:tab_scroller.setHeight(0,true);tab_scroller.changeSpeed(0);$("#whole_scroll").animate({opacity:"1"},1);break;case 43:case 107:if(tab_scroller.scrolling_speed!=500){tab_scroller.incSpeed()}break;case 45:case 109:tab_scroller.decSpeed();break}});$(window).scroll(function(){if($("#whole_scroll:visible").get(0)&&!$("#whole_scroll").hasClass("ui-draggable-dragging")){window_scroll_top=$(window).scrollTop();var f=$("#whole_scroll").offset().top;var c=$(".t_b").offset().top;var a=window_scroll_top>=(f-tab_scroller.scroller_margin);a=a&&tab_scroller.memorized_position<=(f-c);var b=(window_scroll_top+$(window).height()-tab_scroller.scroller_margin)<=(f+$("#whole_scroll").height());b=b&&f>($("#scroll_holder").offset().top+tab_scroller.scroller_margin);b=b&&tab_scroller.memorized_position>=(f-c);if(a||b){if(!$("#whole_scroll").hasClass("fixed")){tab_scroller.memorized_position=parseInt($("#whole_scroll").css("top"));tab_scroller.save_scroll_position=true;var e=$("#whole_scroll").offset().left;if(b){var d=$(window).height()-$("#whole_scroll").height()-tab_scroller.scroller_margin}else{var d=tab_scroller.scroller_margin}$("#whole_scroll").addClass("fixed").css({left:e,top:d})}}else{if(tab_scroller.save_scroll_position){if(tab_scroller.memorized_position>(window_scroll_top+$(window).height()-$("#whole_scroll").height()-tab_scroller.scroller_margin)){var d=$("#scroll_holder").offset().top-window_scroll_top+tab_scroller.scroller_margin;var e=$("#whole_scroll").position().left}else{var d=tab_scroller.memorized_position;var e=$("#whole_scroll").position().left-$(".t_br").offset().left;$("#whole_scroll").removeClass("fixed");tab_scroller.save_scroll_position=false}$("#whole_scroll").css({top:d,left:e})}}}})};TabScroller.prototype.doScroll=function(){if(!this.scrolling_speed){return false}if(!$.browser.opera){$("body:not(:animated)").animate({scrollTop:"+=1"},1,"linear")}$("html").animate({scrollTop:"+=1"},1,"linear");timeout_interval=275-this.scrolling_speed/2;this.to=setTimeout("tab_scroller.doScroll()",timeout_interval);$(".b_a").addClass("b_ac");$("#whole_scroll").show().addClass("ui-draggable").animate({opacity:"0.6"},1)};TabScroller.prototype.changeSpeed=function(a){if(a<=0){a=0;$("#whole_scroll").animate({opacity:"1"},1);clearTimeout(this.to)}if(this.scrolling_speed==0&&a>0){ga_track_event(["_trackEvent","Tab Page","Autoscroll","Autoscroll Start"])}if(a>500){a=500}this.scrolling_speed=a;if(this.scrolling_speed>0&&$(window).scrollTop()>this.of_top){$("#whole_scroll").animate(1000);clearTimeout(tab_scroller.to);tab_scroller.doScroll();if(this.scrolling_speed>0){$("#whole_scroll").animate({opacity:"0.6"},1)}}else{if(this.scrolling_speed){clearTimeout(this.to);this.doScroll();$("#whole_scroll").animate({opacity:"0.6"},1)}else{clearTimeout(this.to)}}};TabScroller.prototype.incSpeed=function(){this.changeSpeed(this.scrolling_speed+100);this.height_gradient++;this.setHeight(this.height_gradient,true)};TabScroller.prototype.decSpeed=function(){this.changeSpeed(this.scrolling_speed-100);this.height_gradient--;this.setHeight(this.height_gradient,true)};TabScroller.prototype.setHeight=function(a,b){if(a<0){a=0}if(a>5){a=5}$("#speed div").removeClass("hover");$("#speed div:lt("+a+")").addClass("hover");if(b){this.height_gradient=a}};function viewComments(b,a){$(".comments_dub").addClass("active");$(".comments-ajax-loader").show();$("html, body").animate({scrollTop:$("#comments").offset().top-110},1000);if(!already_comment_loaded){already_comment_loaded=true;$.ajax({type:"GET",url:"/comment/",dataType:"html",data:"tabid="+tabid,success:function(c){$(".tabcomms").html(c);$(".comments-ajax-loader").hide();$("#comments").fadeIn();show_bad_comments=false;if(a){scroll_to_comments(b)}}})}else{if(a){scroll_to_comments(b)}}}function scroll_to_comments(a){if(a==0){var b="#comments"}else{var b="#c_"+a}$("html, body").animate({scrollTop:$(b).offset().top-110},1000)}function refferers(c){if(c!=-1){var b=0;var a=window.location.hash.substring(1);if(a.indexOf("com_")!=-1){b=parseInt(a.substr(4))}viewComments(b,true)}}function get_appl_api_version(){if(typeof appl_api_version==="undefined"){return 2}else{return appl_api_version}}function showPlayer(){if(isAudioSupported){$("body").removeClass("audio-not-supported");$("body").addClass("audio-supported");$("div.play-on-hover .chfret").live("mouseenter",function(){var i=$(this);var f=i.closest(".main_chord_with_play");var h=f.find("i");var b=f.find("span");var a=f.find(".play_applicature_button").attr("rel");var c=f.parents("#chords_list").get(0)!=undefined;ga_track_event(["_trackEvent","Tab Page","Chords",(c?"Display chords":"Highlight chords")+" Play"]);f.find("b").fadeOut(function(){f.find("b").fadeIn()});var g={beforeFontLoad:function(){h.addClass("sf-load")},afterFontLoad:function(){h.removeClass("sf-load");$("body").addClass("sf-loaded")},playStarted:function(){h.removeClass("sf-load");if(!h.hasClass("sf-play")){h.addClass("sf-play");b.text("playing")}var j=(h.attr("data")===undefined)?0:parseInt(h.attr("data"));j++;h.attr("data",j)},playFinished:function(){var j=(h.attr("data")===undefined)?0:parseInt(h.attr("data"));j--;if(j<=0){j=0;if(!i.is(":hover")){h.removeClass("sf-play");b.text("hover to play")}}h.attr("data",j)}};var d=i.attr("data");if(d!==undefined){i.removeAttr("data");clearTimeout(d)}var e=function(){i.attr("data",setTimeout(function(){playNotesString(a,g);e()},2000))};e();playNotesString(a,g);return false});$("div.play-on-hover .chfret").live("mouseleave",function(){var e=$(this);var d=e.closest(".main_chord_with_play");var b=d.find("i");var c=d.find("span");b.attr("data",0);b.removeClass("sf-play");c.text("hover to play");var a=e.attr("data");if(a!==undefined){e.removeAttr("data");clearTimeout(a);soundOff()}return false})}}function audioDetected(a){}function prepareNotesString(c){var a="";var d;for(var b=5;b>=0;b--){if(c[b]>0){d=parseInt(c[b])+12;a+=d+" "}}return $.trim(a)}var show_fixed_panel=false;if(!navigator.userAgent.match(/(iPhone|iPod|iPad|Android)/i)){$("#fixed_panel").show();show_fixed_panel=true}function right_column_position(){if(show_fixed_panel){if($(window).scrollTop()+$(window).height()>=$(".rt_b").offset().top+$(window).height()-20){$("#fixed_panel.abs").hide().removeClass("abs").show();$(".comm-post.float.embedded").css("top","59px")}else{$("#fixed_panel:not(abs)").hide().addClass("abs").show();if($("#fixed_panel.abs").length){$(".comm-post.float.embedded").css("top",($("#fixed_panel").offset().top-$(window).scrollTop()+40)+"px")}}}}function playNotesString(c,a){var b=c.split(" ");if(isAudioSupported){playChord(b,a)}}function soundOff(){if(isAudioSupported){stopChord()}}function voting(c,a){var b=c.attr("data-rate");if(b>2){send_vote(c,a,"")}else{rate_btn=c;if($("#js-modalRatingExplain").length==0){$.get("http://tabs"+ug_serv+"/tabs/ratingExplain",function(d){$("body").append(d);$(".js-low-rating").text(b);show_modal($("#js-modalRatingExplain"))})}else{$(".js-low-rating").text(b);show_modal($("#js-modalRatingExplain"))}}}function show_modal(a){a.show();$("body").append('<div class="modal-backdrop fade-in"></div>')}function hide_modal(a){a.hide();$(".modal-backdrop").remove()}function send_vote(d,c,a){ga_track_event(["_trackEvent","Tab Page","Rating on "+d.attr("data"),"Rate"]);if(!already_voted){already_voted=true;if(user_id==tabs_user_id){if(c){message_popup("Can`t vote for your own tab",TYPE_ERROR)}}else{increase_votes(1);if(c){message_popup("Thanks for your vote!",TYPE_SUCCESS)}}}var b=d.attr("href");$.ajax({url:"http://www"+ug_serv+"/vote0.php",data:{rowid:tabid,type:3,content:d.attr("data-rate"),comment:a},dataType:"jsonp",error:function(){if(c){message_popup("Unknown error while voting",TYPE_ERROR)}},success:function(e){if(e.status=="success"){$("div.v_c").html(" x "+e.response.votes);current_rating_count=e.response.votes;$("div.voting a").removeClass("cur");current_rating=Math.round(e.response.rating);stars_fill(current_rating,false)}else{if(c){if(e.status==TYPE_ERROR){switch(e.response){case"No permission":show_auth_layer_for_non_activ_users();break;case"Blocked":show_auth_layer_for_blocked_users();break;default:message_popup(e.response,TYPE_ERROR);break}}}}}})}function send_comment(a){$.ajax({url:$("#comment_form").attr("action"),data:{cb_comment:"on",type:4,parent_id:0,ajax_form:1,rowid:$("#comment_form input[name=rowid]").val(),content:a},dataType:"jsonp",type:"POST"})}function add_tab_to_favourite(){var a="http://www"+ug_serv+"/home/favorites/?tabs&fid="+tabid+"&act=addtab";if(!already_favourite){ga_track_event(["_trackEvent","Tab Page","Favorites","Favorites Add"]);message_popup("Added to your favorites",TYPE_SUCCESS);already_favourite=true;$.ajax({url:a,dataType:"jsonp",success:function(c,d,b){if(c.error!=""){message_popup(c.error,TYPE_ERROR)}}})}else{ga_track_event(["_trackEvent","Tab Page","Favorites","Favorites Add Already"])}}function submit_tab_comment(){$("#comment_form").submit()}$(document).ready(function(){if("undefined"!=typeof(instr)){switch(instr){case"ukulele":$("body").addClass("ukulele");break;case"guitar":default:$("body").addClass("guitar");break}}if(!isAudioSupported){$("body").addClass("audio-not-supported")}$(document).keydown(function(d){if(d.ctrlKey&&d.keyCode==67){ga_track_event(["_trackEvent","Tab Page","Ctrl+C","Ctrl+C Click"])}});Chord.init();initFontsize();$(".t_version").mouseenter(function(){ga_track_event(["_trackEvent","Tab Page","Tab Versions","Tab Versions Show"]);$(this).parent().children(".t_versions").show()});$(".t_versions").mouseleave(function(){$(this).hide()});$(".t_versions").bind("click",function(){$(this).hide()});bind_hover();create_chords_list();$(".autoscroll_controller").mouseenter(function(d){if(d.target==this){ui_dragable++;$(this).css("z-index",ui_dragable)}return false});$(".autoscroll_controller").mouseleave(function(){$(this).css("z-index",ui_dragable-1);return false});first_link=$("#print_link").attr("href");$("#disp_ch_highlight").bind("click",function(){ga_track_event(["_trackEvent","Tab Page","Highlight Chords","Highlight Chords "+($(this).hasClass("on")?"Off":"On")]);$(this).toggleClass("on");chk_ch_highlight();return false});$(".show_comments").click(function(){if($(this).hasClass("t_comments_union")){ga_button="Top";need_scroll=true}else{ga_button="Bottom";need_scroll=false;$(this).parent().addClass("loading")}if(!$(this).hasClass("active")){ga_track_event(["_trackEvent","Tab Page","Comments","Comments "+ga_button+" Show"]);viewComments(0,need_scroll)}else{ga_track_event(["_trackEvent","Tab Page","Comments","Comments "+ga_button+" Hide"]);$(this).removeClass("active");$("#comments").fadeOut();$(".comm-post").removeClass("float").addClass("embedded");$(".commentswr").append($(".comm-post"))}return false});$("a.commreply").live("click",function(){if($(this).text()=="edit"&&!$(this).parents(".comment:first").hasClass("updated")){cancel_comment_edit();var e=$(this).parents("div.comment:first").find(".comment_content p").text();var h=$(this).parents(".comment:first").attr("id");h=h.split("_")[1];var g=$(this).parents("div.comment:first").find(".comment_content");g.find("p").hide();g.append('<form id="edit_comment_form" action="http://www'+ug_serv+'/vote0.php"><textarea name="content" id="edit_comment_txt" class="edit_text">'+e+'</textarea><input type="hidden" name="id" value="'+h+'"><input type="hidden" name="act" value="edit"><br><input type="submit" value="Save"><input id="cancel_edit" type="button" value="Cancel"></form>')}else{var f=$("#comment_form").parent();var d=$(this).parent().parent().parent().attr("class");d=d.substring(7,12);f.find("#form_parent_id").val($(this).attr("rel"));f.removeClass();f.addClass("comm-post "+d+" embedded");$("#c_"+$(this).attr("rel")).append(f);$("#comm_txt").focus()}return false});$("#edit_comment_form").live("submit",function(){$.ajax({url:$(this).attr("action"),data:$(this).serialize(),dataType:"jsonp",success:function(e,f,d){}});$("#edit_comment_form").parents(".comment:first").addClass("updated");$("#edit_comment_form").parents(".comment_content:first").find("p").show().html($("#edit_comment_txt").val().replace(/\r\n|\r|\n/g,"<br>"));$("#edit_comment_form").parents(".comment:first").find("a.commreply").text("reply");$("#edit_comment_form").remove();return false});$("#cancel_edit").live("click",function(){cancel_comment_edit();return false});$("#close_reply").live("click",function(){$("#form_parent_id").val("0");if($(this).parents(".comm-post").hasClass("float")){$(this).parents(".comm-post").remove();$("#fixed_add_comment").show()}else{$("#comments").append($(".comm-post"))}$("#comment_form").parent().removeClass("float embedded");return false});$("#comment_form .comment_chks, #comment_form .comment_chkscr").live("click",function(){$("#comment_form input[type=checkbox]").removeAttr("checked");$("#comment_form input[type=checkbox]").removeAttr("disabled");var d=$(this).find("input");d.attr("checked",true);d.attr("disabled","disabled");if(d.attr("name")=="cb_correction"){$(".comment_chkstab").show()}else{$(".comment_chkstab").hide()}});var a=0;var b=false;$(window).scroll(function(){if(!b&&($(window).scrollTop()+$(window).height()>=$("#comments").offset().top+5)){a=$(window).scrollTop();setTimeout(function(){if(a==$(window).scrollTop()){b=true;$(".sad_smile, .bottom_vot").fadeIn(450).animate({opacity:1,"margin-top":"6px",display:"toggle"},{duration:550,queue:false});setTimeout('$(".t_hs .vote-success").show()',50)}},200)}right_column_position()});$(".rate_btn_wrp").live("click",function(){$(this).parent().toggleClass("selected");return false});$(".rate_list_drop a").live("click",function(){$(this).parent().parent().removeClass("selected").find(".rate_btn_wrp").html($(this).html());if(user_id){voting($(this),false)}else{prepare_auth_layer();auth_callback_params.push($(this));auth_callback_params.push(false);show_auth_layer("voting")}return false});$(document).bind("click",function(){if($(".rate_list_drop").is(":visible")){$(".rate_list_btn").removeClass("selected")}});$("div.voting a").click(function(){if(user_id){voting($(this),true)}else{prepare_auth_layer();auth_callback_params.push($(this));auth_callback_params.push(true);show_auth_layer("voting")}return false});$(".js-close-modal").live("click",function(){hide_modal($(".modal"));return false});$("#js-reason-check").live("change",function(){$(this).is(":checked")?$("#js-rating-reason-other").show():$("#js-rating-reason-other").hide()});$(".js-btn-rating-explain").live("click",function(){var g=true;var f=0;var e="";var d=false;$(".js-rating-reason").each(function(){if($(this).is(":checked")){f++;if($(this).attr("data-reason")){if($(this).attr("data-reason")=="Dont-like"){d=true}else{e=e+$(this).attr("data-reason")}}}});if($("#js-reason-check").is(":checked")&&($(".js-rating-reason-input").val().length<25)&&(f==1)){g=false}e=e+$(".js-rating-reason-input").val();!f?$(".js-rating-reason-error").addClass("has-error"):$(".js-rating-reason-error").removeClass("has-error");if(!g){$(".js-rating-reason-other-error").show().addClass("has-error")}else{$(".js-rating-reason-other-error").hide().removeClass("has-error")}if(f&&g){hide_modal($("#js-modalRatingExplain"));if(d){message_popup("Thanks for your vote!",TYPE_SUCCESS);send_comment("didn't like this contribution")}else{send_vote(rate_btn,true,e)}$.ajax({url:"http://www"+ug_serv+"/report_bad_tab.php",data:{submit:1,id:tabid,text:e},dataType:"jsonp",type:"POST"})}return false});$("a.b_f").click(function(){if(user_id){add_tab_to_favourite()}else{prepare_auth_layer();auth_callback_need_activ=false;show_auth_layer("add_tab_to_favourite")}return false});$(".voting a").each(function(d,e){d=(d>4)?d-5:d;$(this).bind("mouseover",function(){stars_fill(d+1,true)})});$("#arr_scroll").bind("click",function(){hide_scroll()});$(".voting").bind("mouseleave",function(){stars_fill(current_rating,false)});chk_ch_highlight();tab_scroller=new TabScroller();$(".b_a").click(function(){if(lock_scroller){return false}var d=$("#whole_scroll");if(d.is(":hidden")){ga_track_event(["_trackEvent","Tab Page","Autoscroll","Autoscroll Show"]);d.fadeIn(100).draggable({containment:"parent"},{handle:".autoscroll_controller_header"});$(window).trigger("scroll");$(".b_a").addClass("b_ac")}else{ga_track_event(["_trackEvent","Tab Page","Autoscroll","Autoscroll Hide"]);d.fadeOut(100);$(".b_a").removeClass("b_ac")}if($(".b-eupp").is(":visible")){d.css("left","10px").css("top","45px")}return false});$(".autoscroll_controller_exit").click(function(){ga_track_event(["_trackEvent","Tab Page","Autoscroll","Autoscroll Hide"]);hide_scroller_widget();return false});$("#c_a").click(function(){$("#r_a").fadeOut(100);if(parseInt($("#whole_scroll").css("top"))==250&&!$("#whole_scroll:visible").get(0)){$("#whole_scroll").css("top","-=205")}return false});$("div.chords_versions_scroller_moveable .chfret").live("click",function(){var f=$(this);var d=f.closest(".cont_chrd");var g=f.closest(".chord-variations-wrapper").find(".main_chord_with_play .cont_chrd");if(d.attr("rel")!=g.attr("rel")){var e=f.closest(".chords_versions_scroller_moveable");g.html(d.html());g.attr("rel",d.attr("rel"));e.find(".chfret_clicked_label").fadeOut(100);d.find(".chfret_clicked_label").fadeIn(100)}return false});$("#disp_ch_diagrams").bind("click",function(){var e=$(this);ga_track_event(["_trackEvent","Tab Page","Display chords","Display chords "+($(this).hasClass("on")?"Off":"On")]);if(!e.hasClass("on")){e.removeClass().addClass("on")}else{e.removeClass("on")}var d=$("#chords_list");if(d.is(":hidden")){if($("#r_a").is(":visible")){d.removeClass("list_wide");d.addClass("list_narrow")}else{d.removeClass("list_narrow");d.addClass("list_wide")}d.fadeIn(100)}else{d.fadeOut(100)}});$("div.varctrl").live("click",function(){onVariationsClick({button:$(this)});return false});$("div.chords_versions_controls_left, div.chords_versions_controls_right").live("click",function(){if(applicature_animation){return false}var j=$(this);var d=$(this).parent().children(".chords_versions_controls_left");var m=$(this).parent().children(".chords_versions_controls_right");var i=j.closest(".diagwrap").find(".chords_versions_scroller_moveable");var h=parseInt(i.attr("rel"));var k=j.hasClass("chords_versions_controls_left")?-1:1;var g=i.children(".cont_chrd").length;var f=Math.ceil(g/2);if(((h==1)&&(k<0))||((h==f)&&(k>0))){return false}var e=h+k;i.attr("rel",e);var l=-k*(ver_w*2);if(e==f){m.fadeOut(100)}if(e==1){d.fadeOut(100)}if((e>1)&&(h==1)){d.fadeIn(100)}if((h==f)&&(e==f-1)){m.fadeIn(100)}i.animate({marginLeft:(l+parseInt(i.css("margin-left")))+"px"},{start:function(){applicature_animation=true},complete:function(){applicature_animation=false}},500);j.parent().children(".chords_versions_controls_info_text").text(e+" of "+f);return false});function c(d){d.addClass("active");setTimeout(function(){d.removeClass("active")},100)}if(typeof unknown_platform=="undefined"){$("a.m_b").click(function(){c($(this));onFontsizeClick(-1);return false});$("a.p_b").click(function(){c($(this));onFontsizeClick(1);return false});$("#fontsize_reset_val").click(function(){onFontsizeClick(-current_fontsize_counter);return false});$(".d_b").click(function(){ga_track_event(["_trackEvent","Tab Page","Transpose","Transpose Down"]);c($(this));onTransposeClick(-1);return false});$(".u_b").click(function(){ga_track_event(["_trackEvent","Tab Page","Transpose","Transpose Up"]);c($(this));onTransposeClick(1);return false});$("#transpose_reset_val").click(function(){onTransposeClick(-current_transpose);return false})}$(".ui-draggable, .ui_not-draggable").live("click",function(d){if(ui_dragable!=$(this).css("z-index")){ui_dragable++;$(this).css("z-index",ui_dragable)}});if(typeof transpose_to!=="undefined"&&transpose_to>0){onTransposeClick(transpose_to)}get_transpose_state_from_local_storage();refferers(def);(function(){var e=false;var d=function(){if(!e){e=true;ga_track_event(["_trackEvent","Tab Page","Print","Show"])}};if(window.matchMedia){var f=window.matchMedia("print");f.addListener(function(g){if(g.matches){d()}})}window.onbeforeprint=d}());addTabToHistory(getTabsHistory());$(".d_l_recent-more").click(function(){$(".d_l_more-items").slideDown();$(this).remove();$.ajax({url:"http://www."+main_server_name+"/xtra/click_contest.php?without_redirect=1&ug_from=epupp&url=tabs_more_click"})});if($(".player.player_fixed").length>0){$(".page-wrap").addClass("tp-player-wrap");$(".player_fixed").animate({bottom:"0"},600)}});function comment_vote(b,a){var c=$("#c_"+b);if(user_id){c.find(".commvalue").addClass("voted");c.find(".cvote a").unbind("click");$.ajax({type:"GET",url:"http://www"+ug_serv+"/vote0_comment.php?ajax=1&callback=?",data:{content:a,rowid:b,jsonp:1},dataType:"jsonp",success:function(f){if(typeof f.result!="undefined"){if(f.result!="success"){if(f.error=="You are not authorized!"){prepare_auth_layer();auth_callback_params.push(b);auth_callback_params.push(a);show_auth_layer("comment_vote")}else{c.find("._votecomment").css("color","#d93838").html(f.error)}}else{var h=c.find(".commvalue ins");var e=parseInt(h.text());e=e?e:0;var g=e+(a>0?1:-1);h.text(g>0?"+"+g:(g?g:""));var d=parseInt(h.text());h.css("color",d>0?"#477e00":(d?"#d93838":"#999"))}}else{c.find("._votecomment").css("color","#999").html("Request error. Please contact our system administrator")}}})}else{prepare_auth_layer();auth_callback_params.push(b);auth_callback_params.push(a);show_auth_layer("comment_vote")}}$(".cvote a").live("click",function(){comment_vote($(this).parent().attr("data"),$(this).hasClass("cplus")?10:-1)});$("#comment_form").submit(function(){if($("#comm_txt").hasClass("error")){$("#com_msg").fadeOut(500)}var a="";$("#comment_form input[type=checkbox]").removeAttr("disabled");if(!$("#comment_form").find("input[type=checkbox]:checked").get(0)){a+="<div><b></b>Please select type above</div>";$("#comment_form .type_wraper").addClass("error")}else{$("#comment_form .type_wraper").removeClass("error")}if($("#comm_txt").val().length<10){a+="<div><b></b>Your comment is too short</div>";$("#comm_txt").addClass("error");$("#comm_txt").focus()}else{$("#comm_txt").removeClass("error")}if(a.length>0){$("#com_msg").fadeIn(500).html(a);return false}if(!user_id){prepare_auth_layer();$("#comm_txt").removeClass("error");$("#com_msg div").remove();show_auth_layer("submit_tab_comment");return false}return true});$(".comment_chkstab").live("click",function(){var a="tab";var i=document.getElementById("comm_txt");var f=document.selection;i.focus();if(f){var g=f.createRange();var j=g.duplicate();var c="["+a+"]"+j.text+"[/"+a+"]"}else{var b=i.selectionStart;var h=i.selectionEnd;var c=i.value.substring(0,b)+"["+a+"]"+i.value.substring(b,h)+"[/"+a+"]"+i.value.substring(h)}c=c.replace(/( )+\[\/(tab)\]/img,"[/$2]$1");if(j){j.text=c}else{i.value=c;i.selectionEnd=i.selectionStart=b}return false});$("#js-bad-comms").live("click",function(a){$(".comment").each(function(){if($(this).attr("data-rating")<-2){if(!show_bad_comments){$(this).show()}else{$(this).hide()}}});if(show_bad_comments){$(this).text($(this).text().replace("hide","show"));show_bad_comments=false}else{$(this).text($(this).text().replace("show","hide"));show_bad_comments=true}return false});$("#fixed_top").click(function(){$("html, body").animate({scrollTop:0},500);return false});$("#fixed_add_comment").click(function(){var a=$("#comment_form").parent().clone().addClass("float embedded");$("body").prepend(a);right_column_position();$("#fixed_add_comment").hide();return false});function create_applicature_widget(d,c,a){var e=null;var b=render_applicature(d,c,a);if(b){e=$(b)}else{e=$("")}return e}function render_applicature(e,d,a){a=$.extend({count_class:""},a);var b=null;e=Chord.convertChordName(e);if(Chord.convertChordName(e)!==undefined){var c=applicature[e];var f=build_variations_list(c,d);b+='<div class="chord-variations-wrapper '+a.count_class+'">';b+=render_head(e);b+='<div class="diagwrap">';b+='<div class="main_chord_with_play"><div class="play-on-hover"><b><i></i><span>hover to play</span></b>';b+='<div class="cont_chrd" rel="0">';if(f.length){b+=f[0]}b+="</div>";b+="</div></div>";b+='<div class="varctrl">variations</div>';b+='<div class="chords_versions_handler">';b+=render_variations_list(f);b+=render_variations_controls(f);b+="</div>";b+="</div>";b+="</div>"}return b}function render_head(a){return'<div class="chord_body chord_body_selector"><div class="diag_head diag_head_selector"><img src="http://'+js_img_domain+'/_img/1x1.gif" class="ch_hm">'+a+'<a href="#"></a></div></div>'}function render_variations_list(c){var b='<div class="chords_versions_handler_limiter">';b+='<div class="chords_versions_scroller_moveable" rel="1">';for(var a=0;a<c.length;a++){b+='<div class="cont_chrd" rel="'+a+'">'+c[a]+"</div>"}b+="</div>";b+="</div>";return b}function build_variations_list(a,h){var e=[];var j=0;for(var b in a){var g=a[b];if(b=="suggested_fret"||b=="old_ch"||(b.substring(0,1)=="_")){continue}j++;var c="";c+='<div class="chfret">';if(j==1){c+='<div class="chfret_clicked_label" style="display: block;"></div>'}else{c+='<div class="chfret_clicked_label"></div>'}c+=render_play_link(g);for(var f=0;f<g.l.length;f++){c+=render_capo(g.l[f].f-g.f+((g.f==0)?0:1),g.l[f].e)}for(var d=0;d<g.t.length;d++){if(g.g[d]>0){c+=render_finger(d,g.t[d]-g.f+((g.f==0)?0:1),g.g[d])}}c+=render_tuning(h);c+=render_strings(find_bass_string(g),g);c+="</div>";c+=render_fret(g);e.push(c)}return e}function render_tuning(e){var b=e.split(" ");var a='<div style="position:absolute; top:-2px; left:5px"><ul class="app_lu">';for(var d=b.length-1;d>=0;d--){if((d==5)&&(e.toLowerCase()=="e a d g b e")){var c="app_ltesm"}else{var c="app_lt"+b[d].toLowerCase().substr(0,1);if(b[d].substr(b[d].length-1,1)=="#"){c+="dz"}}a+='<li class="'+c+'"></li>'}a+="</ul></div>";return a}function render_capo(a,b){return'<div class="barre finger-fret-'+a+" capo-string-"+b+'"></div>'}function render_finger(a,b,c){if(b<0){return""}return'<div class="fingbg finger-string-'+a+" finger-fret-"+b+'"><div class="f-'+c+'"></div></div>'}function render_fret(b){var c="&nbsp;";if(b.f!=0){c=b.f+" fr"}var a='<div class="fs-10 fretnum">'+c+"</div>";return a}function render_play_link(b){var a="";a+='<a class="p_apl play_applicature_button" rel="'+prepareNotesString(b.n)+'" href="#"></a>';return a}function render_strings(d,c){var b='<div class="strings">';for(var a=0;a<c.t.length;a++){b+=render_string(a,d,c.t[a])}b+="</div>";return b}function render_string(b,d,c){var a="f-str";if(-1==c){a="x-str"}else{if(0==c){a="o-str"}}return'<div class="'+a+'" rel="string'+b+" bass"+d+'"></div>'}function render_variations_controls(b){var a='<div class="chords_versions_controls">';a+='<div class="chords_versions_controls_left"><b></b> Prev</div>';a+='<div class="chords_versions_controls_info_text">';a+="1 of "+(Math.ceil(b.length/2));a+="</div>";if(b.length>2){a+='<div class="chords_versions_controls_right">Next <b></b></div>'}a+="</div>";return a}function find_bass_string(d){var c=0;var b=127;for(var a=0;a<d.n.length;a++){if(((d.n[a]%12)==d.x)&&(d.n[a]<=b)){b=d.n[a];c=a}}return c}function cancel_comment_edit(){var a=$("#edit_comment_form").parents("div.comment_content:first");a.find("p").show();$("#edit_comment_form").remove()}function isLocalStorageAvailable(){try{return"localStorage" in window&&window.localStorage!==null}catch(a){return false}}function isJsonAvailable(){try{if(JSON&&typeof JSON.parse==="function"){return true}}catch(a){return false}}var Chord={chord_names:{}};Chord.init=function(){for(var a in applicature){Chord.chord_names[a]=modulate_accord(a,0)}};Chord.convertChordName=function(a){if(applicature[a]!==undefined){return a}else{if(Chord.chord_names[a]!==undefined){return Chord.chord_names[a]}}return undefined};function addTabToHistory(e){var c={id:tabid,artist:ucwords(name_art),name:ucwords(tab_info.name),url:window.location.pathname,v:tab_info.version,type:tab_info.type};var d=false;for(var b=0;b<e.length;b++){if(e[b].id==c.id){d=true}}if(d==false){var a=getTabsHistory().splice(0,4);a.unshift(c);$.cookie("tabs_history",JSON.stringify(a),{expires:365,path:"/",domain:ug_serv})}return e}function ucwords(a){return a.replace(/^(.)|\s(.)/g,function(b){return b.toUpperCase()})}function ga_track_event(c){if((c!==undefined)&&(c[0]=="_trackEvent")&&(a(c))){if(b(10)){_gaq.push(c)}}else{_gaq.push(c)}function b(d){return(0==Math.floor(Math.random()*d))}function a(g){var d=["Tab Page:::Autoscroll:::Autoscroll Start","Tab Page:::Autoscroll:::Autoscroll Show","Tab Page:::Autoscroll:::Autoscroll Hide","Tab Page:::Chords:::Highlight chords Play","Tab Page:::Chords:::Highlight chords Variations Show","Tab Page:::Chords:::Display chords Play","Tab Page:::Chords:::Highlight chords Variations Hide","Tab Page:::Chords:::Display Chords Variations Show","Tab Page:::Chords:::Display Chords Variations Hide","Tab Page:::Comments:::Comments Top Show","Tab Page:::Comments:::Comments Bottom Show","Tab Page:::Ctrl+C:::Ctrl+C Click","Tab Page:::Display chords:::Display chords On","Tab Page:::Display chords:::Display chords Off","Tab Page:::Favorites:::Favorites Add","Tab Page:::Font Size:::Font Size Plus","Tab Page:::Font Size:::Font Size Minus","Tab Page:::Highlight Chords:::Highlight Chords Off","Tab Page:::Highlight Chords:::Highlight Chords On","Tab Page:::Jango.com link:::Jango.com link","Tab Page:::Print:::Show","Tab Page:::Print link:::Print link","Tab Page:::Tab Pro Buttons:::Tab Pro Buttons Click","Tab Page:::Tab Versions:::Tab Versions Show","Tab Page:::Transpose:::Transpose Up","Tab Page:::Transpose:::Transpose Down"];var f=g[1]+":::"+g[2]+":::"+g[3];for(var e=0;e<d.length;e++){if(f==d[e]){return true}}return false}};